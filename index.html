<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WW1 Hex Map - Expanded Earth Layout</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { margin: 0; padding: 1rem; background: #eef2f5; text-align: center; }
    h1 { margin-bottom: 1rem; }

    #map {
      position: relative;
      width: 1400px;
      height: 1000px;
      margin: 0 auto;
    }

    .hex {
      position: absolute;
      width: 90px;
      height: 78px;
      clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
      background: #ccc;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4px;
      font-size: 11px;
      word-break: break-word;
      text-align: center;
      cursor: pointer;
      transition: transform 0.1s ease;
    }

    .hex:hover {
      transform: scale(1.05);
    }

    button {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      background-color: #333;
      color: white;
      cursor: pointer;
    }

    input[type="file"] { display: none; }
  </style>
</head>
<body>
  <h1>WW1 Hex Map (Expanded Earth Layout)</h1>
  <div id="map"></div>
  <div>
    <button id="downloadBtn">Download JSON</button>
    <label style="background:#0077cc; padding:0.5rem 1rem; color:#fff; border-radius:5px; cursor:pointer;">
      Load JSON<input type="file" id="upload" accept="application/json" />
    </label>
  </div>

  <script>
    const COLORS = {
      Neutral: '#dddddd',
      Germany: '#333',
      France: '#0055a4',
      UK: '#cc0000',
      Russia: '#0039a6',
      USA: '#3c3b6e',
      Austria: '#7f0000',
      Ottoman: '#a66',
      Italy: '#008000',
      Japan: '#bc002d',
      Belgium: '#f5cc00',
      Serbia: '#0077be',
      Romania: '#c63',
      Bulgaria: '#884ea0',
      Netherlands: '#ff9900',
      Denmark: '#e60026',
      Ocean: '#99ccee'
    };

    const map = document.getElementById('map');
    const state = { tiles: [] };

    const tileData = [
      { name: 'USA West', owner: 'USA', x: 1, y: 2 },
      { name: 'USA East', owner: 'USA', x: 3, y: 2 },
      { name: 'Mexico', owner: 'Neutral', x: 2, y: 3 },
      { name: 'Canada', owner: 'UK', x: 2, y: 1 },
      { name: 'Brazil', owner: 'Neutral', x: 4, y: 5 },
      { name: 'Argentina', owner: 'Neutral', x: 3, y: 6 },
      { name: 'UK', owner: 'UK', x: 6, y: 1 },
      { name: 'France North', owner: 'France', x: 6, y: 2 },
      { name: 'France South', owner: 'France', x: 6, y: 3 },
      { name: 'Belgium', owner: 'Belgium', x: 6, y: 2.5 },
      { name: 'Germany North', owner: 'Germany', x: 7, y: 2 },
      { name: 'Germany South', owner: 'Germany', x: 7, y: 3 },
      { name: 'Netherlands', owner: 'Netherlands', x: 6.5, y: 1.5 },
      { name: 'Denmark', owner: 'Denmark', x: 7.5, y: 1 },
      { name: 'Austria', owner: 'Austria', x: 8, y: 2 },
      { name: 'Italy', owner: 'Italy', x: 7, y: 4 },
      { name: 'Spain', owner: 'Neutral', x: 5, y: 3 },
      { name: 'Portugal', owner: 'Neutral', x: 5, y: 4 },
      { name: 'Switzerland', owner: 'Neutral', x: 6.5, y: 3.2 },
      { name: 'Serbia', owner: 'Serbia', x: 8, y: 2.5 },
      { name: 'Romania', owner: 'Romania', x: 9, y: 2.5 },
      { name: 'Bulgaria', owner: 'Bulgaria', x: 8.5, y: 3 },
      { name: 'Ottoman West', owner: 'Ottoman', x: 9, y: 3.5 },
      { name: 'Ottoman East', owner: 'Ottoman', x: 10, y: 4 },
      { name: 'Russia West', owner: 'Russia', x: 9, y: 2 },
      { name: 'Russia Central', owner: 'Russia', x: 10, y: 2 },
      { name: 'Russia East', owner: 'Russia', x: 11, y: 2 },
      { name: 'India', owner: 'UK', x: 12, y: 3 },
      { name: 'China', owner: 'Neutral', x: 13, y: 3 },
      { name: 'Japan', owner: 'Japan', x: 14, y: 2 },
      { name: 'Egypt', owner: 'UK', x: 8, y: 4 },
      { name: 'North Africa', owner: 'France', x: 7, y: 4 },
      { name: 'South Africa', owner: 'UK', x: 8, y: 6 },
      { name: 'Norway', owner: 'Neutral', x: 7, y: 1 },
      { name: 'Sweden', owner: 'Neutral', x: 8, y: 1 },
      { name: 'Finland', owner: 'Russia', x: 9, y: 1 },

      // Oceans & Seas
      { name: 'North Atlantic', owner: 'Ocean', x: 4, y: 2 },
      { name: 'South Atlantic', owner: 'Ocean', x: 4, y: 4 },
      { name: 'Western Mediterranean', owner: 'Ocean', x: 6, y: 4 },
      { name: 'Eastern Mediterranean', owner: 'Ocean', x: 8, y: 4.5 },
      { name: 'Indian Ocean', owner: 'Ocean', x: 11, y: 4 },
      { name: 'North Pacific', owner: 'Ocean', x: 2, y: 1 },
      { name: 'South Pacific', owner: 'Ocean', x: 2, y: 5 },
      { name: 'Arctic Ocean', owner: 'Ocean', x: 10, y: 0 },
      { name: 'Black Sea', owner: 'Ocean', x: 9, y: 3 },
      { name: 'Baltic Sea', owner: 'Ocean', x: 8, y: 1.5 }
    ];

    const HEX_WIDTH = 90;
    const HEX_HEIGHT = 78;
    const HEX_HORIZ_OFFSET = HEX_WIDTH * 0.75;
    const HEX_VERT_OFFSET = HEX_HEIGHT;

    tileData.forEach((tile, i) => {
      state.tiles[i] = { ...tile, troops: 0, battlefield: '' };
      const hex = document.createElement('div');
      hex.className = 'hex';
      hex.dataset.index = i;

      const xOffset = tile.x * HEX_HORIZ_OFFSET;
      const yOffset = tile.y * (HEX_HEIGHT * 0.85);

      hex.style.left = `${xOffset}px`;
      hex.style.top = `${yOffset}px`;

      updateHexVisual(hex, tile);
      hex.addEventListener('click', () => editTile(i, hex));
      map.appendChild(hex);
    });

    function editTile(idx, element) {
      const tile = state.tiles[idx];
      const owner = prompt('Owner nation?', tile.owner) || tile.owner;
      const troops = parseInt(prompt('Troop count?', tile.troops) || tile.troops, 10);
      const battlefield = prompt('Linked battlefield/map?', tile.battlefield) || tile.battlefield;
      tile.owner = owner;
      tile.troops = isNaN(troops) ? tile.troops : troops;
      tile.battlefield = battlefield;
      updateHexVisual(element, tile);
    }

    function updateHexVisual(el, tile) {
      el.style.background = COLORS[tile.owner] || '#999';
      el.innerHTML = `<strong>${tile.name}</strong><br>${tile.owner}<br>Troops: ${tile.troops}`;
    }

    document.getElementById('downloadBtn').addEventListener('click', () => {
      const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(state, null, 2));
      const a = document.createElement('a');
      a.href = dataStr;
      a.download = 'hex-earth-map-expanded.json';
      a.click();
    });

    document.getElementById('upload').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (evt) => {
        try {
          const loaded = JSON.parse(evt.target.result);
          if (loaded.tiles && loaded.tiles.length === state.tiles.length) {
            state.tiles = loaded.tiles;
            const allHexes = document.querySelectorAll('.hex');
            allHexes.forEach((el, i) => updateHexVisual(el, state.tiles[i]));
          } else {
            alert('Invalid tile data');
          }
        } catch {
          alert('Could not read JSON');
        }
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>
